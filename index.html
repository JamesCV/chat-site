<!DOCTYPE html>
<html>
    <head>
        <title>
            Chat Dumbass
        </title>
        <style>
            h1 {
                font-size: 50px;
                color:darkslategrey;
                font-family:Arial, Helvetica, sans-serif;
                font-stretch: semi-expanded;
                padding-bottom: 50px;
                padding-left: 20px;
            }

            body {
                background-color: #F7786B;
            }

            .topheader {
                margin-left:5%;
                margin-top: 2%;
                border-left-style:groove;
                border-top-style:groove;
                border-top-left-radius: 50px;
                border-left-width: 6px;
                border-color: #f74331;
                padding-left: 10px;
                
            }
        #chatButton {
            width: 8%;
            height: 3.5vh;
            position: relative;
            bottom: 0vh;;
        }

        #chatInput {
            width: 80%;
            height: 3vh;
            margin-bottom: 5px;
            background-color: #eac0bb;
        }

        #chatForm {
            font-size: 25px;
            font-family: Arial, Helvetica, sans-serif;
            margin-top: 3%;
            margin-left: 5%;
            
        }

        #textBox {
            margin-left: 5%;
            margin-top: 2%;
            border-style: groove;
            border-color: #4f2a26;
            border-width: 5px;
            background-color:#eac0bb;
            height: 65vh;
            width: 120vh;
            color: black;
            overflow: hidden;
            padding-left: 15px;
        }

        </style>

    </head>
    <body onload="messageRefresh()">

        <div class = "topheader">
                <h1>    
                        Welcome to my Chat Website
                    </h1>
        </div>      

        <div id = "textBox">
            
        </div>

        <form id = "chatForm">
            Chat: <input type="text" value="" id="chatInput" name="sentMessage">
            <button id="chatButton" onclick="onSent('textBox');return false;"> Send </button>

        <script>
            var messageArray = [];
            var name = ("");
            function onSent (textBox){
                var msg = document.getElementById('chatInput').value;
                sendToServer("jam boy", msg);

                var messageArray = getFromServer("/getMessage");
                var refinedArray = messageArray.split(',');
                counter = (refinedArray.length - 1)
                var lastItem = refinedArray[counter].split('"')[1].split('"')[0];

                var txtNode = document.createTextNode(name + " :" + lastItem);
                var elementNode = document.createElement("p");
                elementNode.appendChild(txtNode);
                document.getElementById('textBox').appendChild(elementNode);
                
                
                document.getElementById('chatInput').value = ("");
            
            }

            function sendToServer(name, message) {
                var xmlHttp = new XMLHttpRequest(); 
                xmlHttp.open("GET", "/postMessage?name=" + name + "&message=" + message, false);
                xmlHttp.send(null)
            }

            function getFromServer(myUrl) {
                var xmlHttp = new XMLHttpRequest(); 
                xmlHttp.open("GET", myUrl, false);
                xmlHttp.send(null)
                var msgData = xmlHttp.responseText;
                return msgData;
            }        

            function messageRefresh() {
                var messageArray = getFromServer("/getMessage");
                var refinedArray = messageArray.split(',');
                counter = (refinedArray.length)

                for (x = 0; x < counter; x++) {
                    var item = refinedArray[x].split('"')[1].split('"')[0];
                    var txtNode = document.createTextNode(name + " :" + item);
                    var elementNode = document.createElement("p");
                    elementNode.appendChild(txtNode);
                    document.getElementById('textBox').appendChild(elementNode);
                }

            }




        </script>

        </form>
    </body>
</html>